# ❄️ Snowflake: 클라우드 네이티브 데이터 웨어하우스 심층 분석

자산운용 플랫폼의 데이터 레이어 고도화를 위해 최근 가장 주목받는 **클라우드 네이티브** 데이터 웨어하우스(CDW)인 **Snowflake**의 핵심 개념과 아키텍처를 정리합니다.

### ☁️ Snowflake는 완벽한 클라우드 기반 서비스입니다
Snowflake는 자체 하드웨어나 설치형 소프트웨어가 존재하지 않는 **100% 클라우드 기반 SaaS(Software as a Service)**입니다.

1. **설치가 필요 없음**: AWS, Azure, GCP 같은 주요 클라우드 인프라 위에서 구동되며, 사용자는 웹 브라우저나 API를 통해 즉시 서비스를 사용합니다.
2. **서버리스(Serverless) 인프라**: 사용자가 직접 서버를 구매하거나 OS를 관리할 필요가 없습니다. 인프라 관리는 Snowflake가 전담하고 사용자는 데이터 분석에만 집중합니다.
3. **멀티 클라우드 전략**: 특정 클라우드 벤더에 종속되지 않고 AWS에서 Azure로, 또는 GCP로 데이터를 유연하게 운영할 수 있습니다.

---

## 🏗️ 1. Snowflake 핵심 아키텍처
Snowflake의 가장 큰 특징은 **저장(Storage)**과 **연산(Compute)**이 완전히 분리된 멀티 클러스터 공유 데이터 아키텍처입니다.

```mermaid
graph TD
    subgraph "1. Cloud Services (The Brain)"
        CS[인증, 메타데이터 관리, 쿼리 최적화, 보안]
    end

    subgraph "2. Virtual Warehouses (Compute)"
        VW1[전략팀 전용 클러스터]
        VW2[리서치팀 전용 클러스터]
        VW3[ETL 파이프라인 전용]
    end

    subgraph "3. Database Storage (Storage)"
        S3[Centralized Storage: S3 / Azure Blob / GCS]
    end

    CS --- VW1
    CS --- VW2
    CS --- VW3
    VW1 --- S3
    VW2 --- S3
    VW3 --- S3

    style CS fill:#f9f,stroke:#333
    style S3 fill:#bbf,stroke:#333
```

### 3계층 구조의 장점
1.  **Database Storage**: 중앙 집중식 저장소로, 데이터의 단일 진실 공급원(Single Source of Truth) 역할을 합니다.
2.  **Virtual Warehouses (Compute)**: 필요한 만큼 연산 자원을 독립적으로 띄울 수 있습니다. (전략팀이 무거운 쿼리를 돌려도 ETL 파이프라인 속도에 영향 없음)
3.  **Cloud Services**: 메타데이터 관리와 보안을 담당하며, 사용자가 인프라를 직접 관리할 필요가 없는 'Zero Management'를 실현합니다.

---

## 📊 2. Snowflake vs S3 + Parquet 비교

| 비교 항목 | AWS S3 + Parquet (Data Lake) | Snowflake (Data Warehouse) |
| :--- | :--- | :--- |
| **성격** | Raw 파일 저장소 | 완전 관리형 데이터 플랫폼 |
| **관리 부담** | 높음 (컴퓨팅 엔진, 스키마 관리 직접 수행) | 매우 낮음 (SaaS 형태로 즉시 사용 가능) |
| **성능 최적화** | 수동 (파일 크기, 파티셔닝 직접 관리) | 자동 (Micro-partitioning, 클러스터링 자동 수행) |
| **데이터 정합성** | 낮음 (파일 단위 제어 어려움) | 높음 (ACID 트랜잭션 지원) |
| **활용 시나리오** | 로우 데이터 보존, 머신러닝 학습 데이터 | 비즈니스 인텔리전스(BI), 실시간 분석 쿼리 |

### 🛠️ 실무 활용 시나리오 예시

#### 1) AWS S3 + Parquet가 더 적절한 경우
- **상황**: **AI/ML 모델 학습을 위한 방대한 피처(Feature) 저장**.
- **이유**: AI 엔진(TensorFlow, PyTorch)은 DB 쿼리보다 직접 파일을 읽어 처리하는 방식을 선호합니다. 테라바이트급 데이터를 Spark로 한꺼번에 배치 처리하여 모델을 학습시킬 때는 저렴한 S3 저장소에 Parquet 파일로 두는 것이 훨씬 효율적입니다.
- **키워드**: `데이터 레이크`, `ML 워크로드`, `저비용 대량 저장`.

#### 2) Snowflake가 더 적절한 경우
- **상황**: **현업 분석가들이 사용하는 '투자 전략 리포팅 플랫폼'**.
- **이유**: 퀀트 분석가나 경영진이 SQL로 즉시 주가 데이터를 조회하고, 이를 Grafana나 Tableau 같은 대시보드에 연동해야 할 때 적합합니다. S3처럼 파일 관리나 엔진 구축 고민 없이, SQL 하나만으로 초고속 집계 연산이 가능하기 때문입니다.
- **키워드**: `데이터 웨어하우스`, `Ad-hoc 쿼리`, `BI 대시보드 연동`.

**핵심 차이**: S3+Parquet은 **'재료(파일)'**라면, Snowflake는 **'완성된 주방(엔진+저장소+관리도구)'**입니다. Snowflake 내부는 실제로 독자적인 압축 컬럼 포맷을 사용하며, 이는 Parquet보다 더 정교한 메타데이터 관리를 제공합니다.

---

## 🔄 3. OLTP vs OLAP 상세 비교

데이터베이스를 활용하는 두 가지 상반된 목적에 대한 이해입니다.

| 비교 항목 | OLTP (Transaction) | OLAP (Analytics) |
| :--- | :--- | :--- |
| **풀 네임** | **O**nline **T**ransaction **P**rocessing | **O**nline **A**nalytical **P**rocessing |
| **주 목적** | **실시간 거래 및 데이터 관리** | **대규모 데이터 분석 및 인사이트 도출** |
| **데이터 단위** | 낱개(Row) 단위의 잦은 읽기/쓰기 | 대량(Column) 단위의 복잡한 집계 연산 |
| **사용자** | 실시간 서비스 이용자, 프런트엔드 앱 | 분석가, 데이터 사이언티스트, 경영진 |
| **대표 기술** | PostgreSQL, MySQL, Oracle | **Snowflake**, BigQuery, Redshift |

### 🏦 자산운용 플랫폼에서의 활용 사례

#### 1) OLTP (실시간 주문 및 계좌 관리)
- **상황**: "사용자가 삼성전자 10주 매수 주문을 냈다."
- **특징**: `주문` 테이블에 새로운 행(Row)을 하나 추가하고, `잔고` 테이블의 수량을 즉시 업데이트해야 합니다. 
- **핵심 가치**: **무결성(Integrity)**. 돈이 오가는 데이터이므로 0.1초라도 틀어지면 안 되며, 행 단위의 빠른 처리가 중요합니다.

#### 2) OLAP (전략 백테스팅 및 리포팅)
- **상황**: "지난 10년간 코스피 2,000개 종목의 평균 PBR 추이를 계산하라."
- **특징**: 수억 건의 데이터를 한꺼번에 읽어서 평균(AVG), 합계(SUM) 등의 계산을 수행해야 합니다.
- **핵심 가치**: **처리량(Throughput)**. 방대한 데이터를 얼마나 빠르게 한꺼번에 읽어서 계산 결과를 뱉어내느냐가 중요합니다.

---

## 📈 4. 수직 확장(Scale-up) vs 수평 확장(Scale-out) 상세

데이터 플랫폼의 부하가 늘어날 때 이를 해결하는 두 가지 철학적 차이입니다.

### 🏢 1) 수직 확장 (Scale-up)
- **개념**: 기존 서버의 **하드웨어 사양(CPU, RAM)을 더 좋은 것으로 교체**하는 방식입니다.
- **특징**:
    - **장점**: 소프트웨어 구조를 바꿀 필요가 없어 관리가 단순합니다.
    - **단점**: 하드웨어 성능에는 물리적 한계가 있으며, 성능이 올라갈수록 가격이 기하급수적으로 비싸집니다. 교체 시 서비스 중단(Downtime)이 발생할 수 있습니다.
- **일반 RDB가 이를 선호하는 이유**: 데이터의 일관성(ACID)을 지키기 위해서는 하나의 뇌(CPU)가 장부를 관리하는 것이 가장 안전하기 때문입니다.

### 🚀 2) 수평 확장 (Scale-out)
- **개념**: 똑같은 성능의 **서버를 여러 대 추가하여 부하를 분산**하는 방식입니다.
- **특징**:
    - **장점**: 이론상 무한대로 확장이 가능하며, 장비 하나가 죽어도 다른 장비가 대체할 수 있어 고가용성(HA) 확보에 유리합니다.
    - **단점**: 데이터를 여러 장비에 골고루 나누고(Sharding), 다시 합치는 과정이 매우 복잡합니다.
- **Snowflake가 이를 자동화한 방식**: 
    - **Storage-Compute 분리**: 데이터는 한 곳(S3)에 있고, 연산 장치(Warehouse)만 옆으로 늘리면 됩니다. 
    - **Auto-scaling**: 쿼리량이 많아지면 Snowflake가 알아서 연산 노드를 1대에서 10대로 늘렸다가, 작업이 끝나면 다시 줄여 비용을 최적화합니다.

---

## 💡 퀀트 플랫폼 엔지니어링 관점에서의 가치

### 1. Zero Copy Cloning (데이터 복제 제로)
*   **기능**: 실제 데이터를 물리적으로 복사하지 않고도 메타데이터만 복제하여 실시간으로 개발/스테이징 환경을 만듭니다.
*   **퀀트 활용**: 10년치 시계열 데이터를 복사하는 비용과 시간 없이, 분석가에게 즉시 실험용 샌드박스 환경을 제공할 수 있습니다.

### 2. Time Travel (타임 트래블)
*   **기능**: 과거 특정 시점(최대 90일)의 데이터를 즉시 조회하거나 복구할 수 있습니다.
*   **퀀트 활용**: 백테스팅 중 데이터 오류가 발견되었을 때, "어제 오후 2시 시점의 데이터 상태"로 엔진을 돌려보며 원인을 파악할 수 있습니다. (**PIT 정합성** 확보에 매우 유리)

### 3. Data Sharing (데이터 공유)
*   **기능**: 외부 벤더의 데이터를 복사(ETL)하지 않고도 Snowflake 네트워크 내에서 즉시 참조할 수 있습니다.
*   **퀀트 활용**: 데이터 공급업체(Bloomberg 등)가 Snowflake를 지원한다면, 복잡한 수집 파이프라인 없이 실시간으로 원천 데이터를 조회할 수 있습니다.

---

## 🚀 면접용 핵심 멘트

> "Snowflake는 단순히 클라우드에 있는 DB가 아니라, **저장과 연산을 완전히 분리하여 자원의 효율성을 극대화한 플랫폼**입니다. 
> 특히 퀀트 플랫폼 엔지니어로서 주목하는 점은 **Time Travel** 기능을 통한 데이터 정합성 유지와, **Zero Copy Cloning**을 활용해 수 TB의 시계열 데이터를 분석가에게 비용 효율적으로 제공할 수 있다는 점입니다. 
> 인프라 관리 부담을 줄이고 대신 **데이터 모델링과 분석 성능 최적화**에 더 집중할 수 있게 해주는 것이 Snowflake의 가장 큰 강점이라고 생각합니다."
