# Lec 1-0: NumPy 기초와 금융 데이터 처리의 초석

이 장에서는 퀀트 투자의 데이터 분석에서 가장 기본이 되는 **NumPy(Numerical Python)** 라이브러리를 학습합니다. NumPy는 고성능 수치 계산을 위해 설계되었으며, 특히 대규모 배열 및 행렬 연산에 최적화되어 있습니다.

## 1. 코드와 실행 결과 (Step-by-Step)

### 1.1. NumPy ndarray 생성 및 기본 속성
NumPy의 기본 단위인 `ndarray`를 생성하고 Python 리스트와의 차이점을 확인합니다.

```python
import numpy as np

# 1차원 배열 생성
a = np.array([1, 2, 3])
print(f"배열 a: {a}")
# 출력: 배열 a: [1 2 3]

print(f"타입: {type(a)}")
# 출력: 타입: <class 'numpy.ndarray'>

print(f"인덱싱 a[0]: {a[0]}")
# 출력: 인덱싱 a[0]: 1
```

---

### 1.2. 벡터화 연산 (Vectorization) 및 유니버설 함수 (Universal Functions)
반복문(`for`) 없이도 배열 전체에 대해 한 번에 연산을 수행하는 핵심 기능입니다. NumPy가 제공하는 다양한 수학 함수(Universal Functions)도 벡터화되어 동작합니다.

```python
# Python 리스트 연산 (느림, 반복문 필요)
list_a = [1, 2, 3]
list_b = [4, 5, 6]

new_list = []
for e1, e2 in zip(list_a, list_b):
    new_list.append(e1 + e2)
print(f"반복문 사용 결과: {new_list}")
# 출력: 반복문 사용 결과: [5, 7, 9]

print(f"리스트 더하기 (단순 결합): {list_a + list_b}")
# 출력: 리스트 더하기 (단순 결합): [1, 2, 3, 4, 5, 6]

# NumPy 벡터화 연산 (빠름, 직관적)
np_a = np.array([1, 2, 3])
np_b = np.array([4, 5, 6])
print(f"NumPy 더하기 (요소별 합): {np_a + np_b}")
# 출력: NumPy 더하기 (요소별 합): [5 7 9]

# 주요 유니버설 함수 예시
print(f"np.sum(np_a): {np.sum(np_a)}")
# 출력: np.sum(np_a): 6

print(f"np.abs([-1, -2]): {np.abs(np.array([-1, -2]))}")
# 출력: np.abs([-1, -2]): [1 2]

print(f"np.log([1, 10]): {np.log(np.array([1, 10]))}")
# 출력: np.log([1, 10]): [0.         2.30258509]

print(f"np.isnan([1, np.nan]): {np.isnan(np.array([1, np.nan]))}")
# 출력: np.isnan([1, np.nan]): [False  True]
```

---

### 1.3. N차원 배열 (행렬) 처리
금융 데이터의 '시계열-종목' 구조를 표현하는 2차원 배열을 다룹니다.

```python
# 2차원 행렬 생성
matrix_a = np.array([[1, 2], [3, 4]])
print("2차원 행렬 matrix_a:")
print(matrix_a)
# 출력:
# [[1 2]
#  [3 4]]

# 행렬 연산
print("행렬 요소별 합 (matrix_a + matrix_a):")
print(matrix_a + matrix_a)
# 출력:
# [[2 4]
#  [6 8]]
```

---

## 2. 주요 개념 및 학습 포인트

### 2.1. NumPy ndarray (N-dimensional Array)
NumPy의 핵심 객체인 `ndarray`는 파이썬의 기본 리스트(List)와 비슷해 보이지만, 내부적으로는 매우 다르게 동작합니다.
- **고정 타입**: 리스트와 달리 모든 요소가 동일한 데이터 타입이어야 합니다.
- **연속된 메모리 배치**: 데이터를 메모리에 연속적으로 배치하여 접근 속도가 매우 빠릅니다.
- **기능의 차이**: 리스트에는 있는 `append()` 같은 함수가 없는데, 이는 배열의 크기를 변경하면 새로운 메모리 할당이 필요하기 때문입니다.

### 2.2. 벡터화(Vectorization)와 성능
가장 중요한 포인트입니다. 파이썬 리스트로 두 배열의 합을 구하려면 `for` 루프를 사용해야 하지만, NumPy는 `a + b` 만으로 요소별 연산(Element-wise)이 가능합니다.

#### 💡 왜 NumPy의 벡터화 연산이 `for` 루프보다 빠를까?
NumPy가 내부적으로 루프 없이도 빠르게 동작하는 이유는 다음과 같습니다.

1.  **C 언어 기반의 최적화**: NumPy의 핵심 연산은 파이썬이 아닌 **C 언어**로 작성되어 있습니다. 파이썬의 `for` 루프는 매 반복마다 객체의 타입 체크와 오버헤드가 발생하지만, NumPy는 미리 컴파일된 C 코드를 호출하여 이를 생략합니다.
2.  **연속된 메모리 배치 (Contiguous Memory)**: NumPy 배열은 메모리 상에 데이터가 물리적으로 나란히 붙어 있습니다. 이는 CPU 캐시 적중률(Cache Hit)을 높여 데이터 접근 속도를 극대화합니다. 반면, 파이썬 리스트는 각 요소가 메모리 여기저기에 흩어져 있는 객체들의 참조값만 모아둔 형태라 접근 속도가 상대적으로 느립니다.
3.  **SIMD (Single Instruction, Multiple Data)**: 최신 CPU는 한 번의 명령어로 여러 데이터를 동시에 처리할 수 있는 SIMD 기능을 지원합니다. NumPy는 이 하드웨어 가속을 활용하여 여러 개의 요소를 한꺼번에 계산합니다.

| 구분 | 파이썬 리스트 (List) | NumPy 배열 (ndarray) |
| :--- | :--- | :--- |
| **연산 방식** | 루프(`for`) 사용 권장 | 벡터화 연산 (내부적 C 구현) |
| **`+` 연산자** | 리스트 연결 (Concatenation) | 요소별 합 (Element-wise Sum) |
| **성능** | 데이터가 많아질수록 매우 느려짐 | 대규모 연산에서 압도적 속도 |

> **💡 퀀트 투자에서의 의미**: 
> 수만 개의 종목(Ticker)에 대해 매일의 수익률을 계산하거나 기술적 지표를 산출할 때, `for` 루프를 사용하면 백테스팅 속도가 현저히 느려집니다. NumPy의 벡터화 연산은 백테스팅 엔진의 성능을 결정짓는 핵심 요소입니다.

### 2.3. N차원 배열 (행렬)
데이터프레임(Pandas)의 기초가 되는 2차원 배열(Matrix) 처리 방법을 익힙니다. 
- 금융 데이터에서 **행(Row)**은 대개 '날짜'나 '종목'을 의미하고, **열(Column)**은 '가격', '수익률', '재무지표' 등을 의미합니다.

---

## 3. 시각적 이해 (추상화)

### 리스트 vs NumPy 배열 연산 비교

**Python List (`a + b`):**
```
[1, 2, 3] + [4, 5, 6]  =>  [1, 2, 3, 4, 5, 6]
(기차 칸을 이어 붙이는 것과 같음)
```

**NumPy Array (`a + b`):**
```
  [1, 2, 3]
+ [4, 5, 6]
-----------
  [5, 7, 9]
(각 위치의 요소끼리 즉시 합산 - 벡터화)
```

### 2차원 배열 구조
```
matrix_a = [ [1, 2],
             [3, 4] ]

인덱스 접근:
matrix_a[0][1]  --> 1행 2열의 값 (2)
```

---

## 4. 학습 결론
NumPy는 **"반복문을 쓰지 않고도 대량의 데이터를 한 번에 연산할 수 있게 해주는 도구"**입니다. 이 강력한 수치 계산 능력이 있기에 우리가 복잡한 퀀트 전략을 순식간에 검증할 수 있습니다. 

다음 장에서는 이 NumPy를 기반으로 실무에서 더 자주 쓰이는 **Pandas**의 `Series`와 `DataFrame`에 대해 알아보겠습니다.

---

## 5. 주요 라이브러리 함수 정리

| 라이브러리 | 클래스/모듈 | 함수명 | 설명 |
| :--- | :--- | :--- | :--- |
| **NumPy** | `np` | `array()` | 리스트, 튜플 등을 NumPy의 다차원 배열(ndarray)로 변환 |
| **NumPy** | `np` | `sum()` | 배열 요소들의 전체 합계를 계산 |
| **NumPy** | `np` | `abs()` | 모든 요소의 절대값을 계산 |
| **NumPy** | `np` | `log()` | 자연 로그(Natural Logarithm) 연산 수행 |
| **NumPy** | `np` | `exp()` | 지수 함수(Exponential Function) 연산 수행 |
| **NumPy** | `np` | `isnan()` | 요소가 결측치(NaN)인지 여부를 판단 (Boolean 배열 반환) |
