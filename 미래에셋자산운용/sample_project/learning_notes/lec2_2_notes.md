# Lec 2-2: 수익률의 이해 (Simple Return vs Log Return)

이 장에서는 금융 데이터 분석에서 가장 중요한 지표인 **수익률(Return)**의 산출 방식과 산술적 특성을 학습합니다. 특히 단순 수익률과 로그 수익률의 차이점, 그리고 각각이 사용되는 실무적인 이유를 다룹니다.

## 1. 단순 수익률 (Simple Return)

### 1.1. 개념 및 계산
가장 직관적인 수익률 계산 방식입니다.
- **수식**: $r_n = \frac{p_n}{p_{n-1}} - 1$
- **특징**: 여러 종목의 수익률을 합산하여 포트폴리오 수익률을 구할 때 유리합니다.

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({"price":[1, 1.02, 1.01, 1.05]})

# pct_change()를 이용한 단순 수익률 계산
simple_rtn = df['price'].pct_change().fillna(0)
print(f"단순 수익률: {simple_rtn.tolist()}")
# 출력: 단순 수익률: [0.0, 0.02, -0.0098, 0.0396]

# 누적 수익률 계산 (1 + r).cumprod()
cum_rtn_simple = (1 + simple_rtn).cumprod()
print(f"최종 누적 수익률: {cum_rtn_simple.iloc[-1]}")
# 출력: 최종 누적 수익률: 1.05
```

---

## 2. 로그 수익률 (Log Return)

### 2.1. 개념 및 계산
연속 복리를 가정하는 수익률 계산 방식입니다.
- **수식**: $r_n = \ln(\frac{p_n}{p_{n-1}})$
- **특징**: 시간 흐름에 따른 수익률을 합산(Sum)하여 누적 수익률을 구할 수 있어 수학적 모델링에 유리합니다.

```python
# 로그 수익률 계산: log(p_n / p_{n-1})
log_rtn = np.log(df['price'] / df['price'].shift(1)).fillna(0)
print(f"로그 수익률: {log_rtn.tolist()}")
# 출력: 로그 수익률: [0.0, 0.0198, -0.0098, 0.0388]

# 누적 수익률 계산 exp(sum(r))
cum_rtn_log = np.exp(log_rtn.cumsum())
print(f"최종 누적 수익률: {cum_rtn_log.iloc[-1]}")
# 출력: 최종 누적 수익률: 1.05
```

---

## 3. 로그 수익률을 사용하는 이유 (Advanced)

1.  **가법성 (Additivity)**: 여러 기간의 로그 수익률을 단순히 더하는 것만으로 전체 기간의 로그 수익률을 구할 수 있습니다.
2.  **수치적 안정성**: 아주 작은 소수점의 곱셈은 언더플로우(Underflow) 문제를 일으킬 수 있으나, 로그를 통한 덧셈은 이로부터 안전합니다.
3.  **정규성 근사**: 중심극한정리에 의해 로그 수익률의 합(또는 평균)은 정규분포에 근사하는 경향이 있어 통계적 모델링이 용이합니다.
4.  **대칭성**: 단순 수익률은 -50% 손실 후 +50% 수익이 나도 원금이 회복되지 않지만(0.75배), 로그 수익률은 -x와 +x를 더하면 0이 되어 본전이 되는 대칭적 구조를 가집니다.

---

## 4. 학습 포인트 (퀀트 투자 관점)

1.  **시점 조정 (`shift`)**: 수익률 계산 시 `p_n / p_{n-1}` 구조를 만들기 위해 `shift(1)`을 사용하여 데이터를 한 칸 아래로 미는 과정을 이해해야 합니다.
2.  **실무적 선택**: 
    *   **다수 종목(Multiple Assets)**의 단기 수익률 합산 시에는 **단순 수익률**을 주로 사용합니다.
    *   **단일 종목(Single Asset)**의 장기 시계열 모델링이나 리스크 관리(VaR 등) 시에는 **로그 수익률**이 선호됩니다.

---

## 5. 주요 라이브러리 함수 정리

| 라이브러리 | 클래스/모듈 | 함수명 | 설명 |
| :--- | :--- | :--- | :--- |
| **Pandas** | `Series/DataFrame` | `pct_change()` | 이전 요소 대비 변화율(단순 수익률) 계산 |
| **Pandas** | `Series/DataFrame` | `shift()` | 데이터를 특정 기간만큼 이동 (기본값 1) |
| **Pandas** | `Series/DataFrame` | `cumprod()` | 누적 곱 계산 (단순 수익률 누적 시 활용) |
| **Pandas** | `Series/DataFrame` | `cumsum()` | 누적 합 계산 (로그 수익률 누적 시 활용) |
| **NumPy** | `np` | `log()` | 자연 로그 연산 수행 |
| **NumPy** | `np` | `exp()` | 지수 함수 연산 수행 (로그 수익률을 가격으로 환원 시 활용) |
